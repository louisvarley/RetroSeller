{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}
{% block page_subtitle %}{{ description }}{% endblock %}
{% block body %}
	{% embed "Tables/table-base.html" with {'table_id': controller, 'headers': ["Id","Status", "Name", "Date", "Total Spend","Share", ""]	} %}
		{% block table_body %}
			{% for entity in entities %}
				<tr>			
				<td>{{ entity.id }}</td>
				<td><span class="badge badge-{{ entity.status.name | lower | replace({' ': ''}) }}">{{ entity.status.name }}</span></td>			
				<td>{{ entity.name }}</td>	
				<td>{{ entity.date | date('d/m/Y') }}</td>
				<td class="{{ entity.totalSpend | rag }}">{{ entity.totalSpend  | format_currency('GBP', {rounding_mode: 'floor'}) }}</td>
				<td>
					<div class="progress">
					{% for account in entity.expenseShare %}
						<div data-tooltip="{{ account.name }} {{ account.percentage |round(1, 'floor') }}%" class="progress-bar tool-tip" role="progressbar" style="background-color:{{ account.color }}; width: {{ account.percentage }}%" aria-valuenow="{{ account.amount }}" aria-valuemin="0" aria-valuemax="{{ entity.totalSpend }}"></div>
					{% endfor %}
					</div>
				</td>
				<td>
				{% include '/Buttons/edit-button.html' with {'model': controller, 'id': entity.id} %}
				{% include '/Buttons/buy-button.html' with {'model': controller, 'id': entity.id} %}				
				{% include '/Buttons/modal-button.html' with {'modal': entity.id, 'id': entity.id} %}
				{% include '/Buttons/delete-button.html' with {'model': controller, 'id': entity.id} %}

				<div class="modal" id="modal-{{entity.id}}" tabindex="-1" role="dialog">
				  <div class="modal-dialog" role="document">
					<div class="modal-content">
					  <div class="modal-header">
						<h5 class="modal-title">{{ entity.name }} Expenses</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						  <span aria-hidden="true">&times;</span>
						</button>
					  </div>
					  <div class="modal-body">
						<table>
							<tr>
								<th>Account</th>
								<th>Date</th>							
								<th>Expense</th>				
								<th>Amount</th>
								<th></th>
							</tr>
							{% for expense in entity.expenses %}
							
							<tr {% if( entity.buyout != null and entity.buyout.account.id != expense.account.id ) %}class="buyout"{% endif %}>
								<td>{{ expense.account.name }}</td>
								<td>{{ expense.date | date('d/m/Y') }}</td>
								<td>{{ expense.name }}</td>				
								<td>{{ expense.proporationAmount | format_currency('GBP', {rounding_mode: 'floor'}) }} / {{ expense.amount | format_currency('GBP', {rounding_mode: 'floor'}) }}</td>
								<td>{% include '/Buttons/edit-button.html' with {'model': "expense", 'id': expense.id} %}</td>
							</tr>
							{% endfor %}
						</table>
					  </div>
					  <div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					  </div>
					</div>
				  </div>
				</div>
				

				
				</td>
				</tr>
				
			{% endfor %}
		{% endblock %}
	{% endembed %}
{% endblock %}
